<!DOCTYPE html>
<html lang="en" ng-app="myApp">
<head>
	<meta charset="UTF-8">
	<title></title>
	<style>
      .container{
		  width: 70%;
		  display: grid ;
		  grid-template-columns: 1fr 1fr ;
		  grid-template-rows: 1fr 1fr ;
	  }
	  .visible{
		  visibility: hidden ;
	  }
	  input.ng-invalid{
		  color: red;
	  }
	  input.ng-valid{
		  color: blue;
	  }
	  .error{
		  visibility: visible;
		  color: indigo;
	  }
	</style>
</head>
<body>
	<form name="signin_form">
	<div class="container">
		<div class="item">Title</div>
		<div class="item">EZoffice</div>
		<div class="item">email</div>
		<div class="item"><input type="text" name="login_id" ng-model="login_id" id-check ng-focus/></div>
		<div class="item">password</div>
		<div class="item"><input type="password" name="login_pw"/></div>
	</div>
	<!--
	<div class="error container" ng-show="signin_form.login_id.$dirty && signin_form.login_id.$invalid">
	-->
	<div class="container visible" ng-class="{ error: signin_form.login_id.$dirty && signin_form.login_id.$invalid && !signin_form.login_id.$focused }">
		<h3>Error #1</h3>
		<p>이메일 형식이 잘못되었습니다.</p> 
	</div>
	</form> 
	<script src="/lib/angular/angular.min.js"></script>
	<script>
		angular.module('myApp',[])
        .directive('idCheck', function(){
			function ValidateEmail(mail)
			{
			 if (/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(mail))
			  {
				return (true)
			  }
			//	alert("You have entered an invalid email address!")
				return (false)
			}
			return{ 
			 restrict: 'A',
			 require:'ngModel',
			 link: function( scope, elem , attrs , ngModelCtrl ){
				 ngModelCtrl.$parsers.push( function( value ){
					 console.log( value );
					 ngModelCtrl.$setValidity('idCheck', ValidateEmail( value ))
					 return value 
				 })
			 }
		}
	   })
       .directive('ngFocus', function(){
		   var FOCUS_CLASS = "ng-focused"
		   return {
			   restrict:'A',
			   require:'ngModel',
			   link : function( scope, elem, attrs , ctrl ){
				   ctrl.$focused = false 
				   elem.bind('focus', function(evt){
					   elem.addClass( FOCUS_CLASS )
					   scope.$apply( function(){
						   ctrl.$focused = true;
					   })
				   }).bind('blur', function(evt){
					   elem.removeClass( FOCUS_CLASS )
					   scope.$apply( function(){
						   ctrl.$focused = false;
					   })
				   })
			   }
			}
	   })
      
	</script>
</body>
</html>
